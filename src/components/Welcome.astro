

---
// No necesitamos importar procesarPedido ya que haremos la petición directamente
---
<div class="min-h-screen flex items-center justify-center bg-gray-100 p-4">

  <form 
  id="pedidoForm" 
  class="bg-white p-8 rounded-2xl shadow-lg w-full max-w-md space-y-4"
  >
  <div id="error-container"></div>
  
  <h2 class="text-2xl font-bold text-center text-gray-700">Formulario de Pedido</h2>
  
  <div class="grid grid-cols-2 gap-3">
  <div class="">
    <label class="block  text-gray-600 mb-1" for="opciones" >Local</label>
    <select id="opciones" name="opciones" class="p-2 font-semibold focus:ring-blue-500 focus:border-blue-500 border border-gray-300 rounded-md w-full ">
      <option value="Local Guernica">Local Guernica</option>
      <option value="Central Glew">Central Glew</option>
    </select>
  </div>
  <div>
    <label class="block text-gray-600 mb-1" for="estado" >estado</label>
    <select id="estado" name="estado" class="p-2 font-semibold focus:ring-blue-500 focus:border-blue-500 border border-gray-300 rounded-md w-full ">
      <option value="Inicio">Inicio</option>
      <option value="Produccoin">Produccion</option>
      <option value="Envio">Envio</option>
      <option value="Ingreso">Ingreso</option>
      <option value="Final">Final</option>
    </select>
  </div>
  
  <div>
    <label class="block text-gray-600 mb-1">Fecha</label>
    <input type="text" name="fecha" id="fecha" required readonly class="w-full border rounded-lg p-2 bg-gray-100">
  </div>
  
    <div>
      <label class="block text-gray-600 mb-1">Pollo</label>
      <input type="text" name="pollo" class="w-full border rounded-lg p-2">
    </div>
    <div>
      <label class="block text-gray-600 mb-1">Milanesa</label>
      <input type="text" name="mila" class="w-full border rounded-lg p-2">
    </div>
    <div>
      <label class="block text-gray-600 mb-1">Pata</label>
      <input type="text" name="pata" class="w-full border rounded-lg p-2">
    </div>
    <div>
      <label class="block text-gray-600 mb-1">Alita</label>
      <input type="text" name="alita" class="w-full border rounded-lg p-2">
    </div>
    <div>
      <label class="block text-gray-600 mb-1">Suprema</label>
      <input type="text" name="suprema" class="w-full border rounded-lg p-2">
    </div>
    <div>
      <label class="block text-gray-600 mb-1">Menudo</label>
      <input type="text" name="menudo" class="w-full border rounded-lg p-2">
    </div>
    <div class="">
      <label class="block text-gray-600 mb-1">Rebosador</label>
      <input type="text" name="rebosador" class="w-full border rounded-lg p-2">
    </div>
  </div>
  
  <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition">
    Enviar Pedido
  </button>
</form>

</div>
<script>
    // Establecer fecha actual automáticamente
    const fechaInput = document.getElementById('fecha') as HTMLInputElement;
    if (fechaInput) {
        const hoy = new Date();
        const dia = String(hoy.getDate()).padStart(2, '0');
        const mes = String(hoy.getMonth() + 1).padStart(2, '0');
        const año = hoy.getFullYear();
        fechaInput.value = `${dia}/${mes}/${año}`;
    }

    // Manejar envío del formulario
    const form = document.getElementById('pedidoForm');
    if (form) {
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target as HTMLFormElement);
            
            const data = {
                local: formData.get('opciones'),
                estado: formData.get('estado'),
                fecha: formData.get('fecha'),
                pollo: Number(formData.get('pollo') || 0),
                mila: Number(formData.get('mila') || 0),
                pata: Number(formData.get('pata') || 0),
                alita: Number(formData.get('alita') || 0),
                suprema: Number(formData.get('suprema') || 0),
                menudo: Number(formData.get('menudo') || 0),
                rebosador: Number(formData.get('rebosador') || 0),
            };

            try {
                const errorContainer = document.getElementById('error-container');
                
                // Mostrar mensaje de carga
                if (errorContainer) {
                    errorContainer.innerHTML = '<div class="text-blue-500">Enviando pedido...</div>';
                }

                const response = await fetch('https://web-66vzoi1semdv.up-de-fra1-k8s-1.apps.run-on-seenode.com/stock', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                if (!response.ok) {
                    throw new Error(`Error: ${response.status} ${response.statusText}`);
                }

                const result = await response.json();
                
                if (errorContainer) {
                    errorContainer.innerHTML = '<div class="text-green-500">Pedido enviado con éxito!</div>';
                }
                
                // Limpiar el formulario
                (form as HTMLFormElement).reset();
                
                // Restablecer la fecha
                if (fechaInput) {
                    const hoy = new Date();
                    const dia = String(hoy.getDate()).padStart(2, '0');
                    const mes = String(hoy.getMonth() + 1).padStart(2, '0');
                    const año = hoy.getFullYear();
                    fechaInput.value = `${dia}/${mes}/${año}`;
                }
            } catch (error: any) {
                console.error('Error:', error);
                const errorContainer = document.getElementById('error-container');
                if (errorContainer) {
                    errorContainer.innerHTML = `<div class="text-red-500">Error al enviar el pedido: ${error.message || 'Error desconocido'}</div>`;
                }
            }
        });
    }
</script>