

<div class=" min-h-screen flex-row justify-items-center content-center bg-stone-200 p-4">
  <div class="relative  max-w-2xl ">
    <div class="absolute -top-6 ">
      <button class="bg-[#CFC0AB] px-5 py-1 pb-10 rounded-md flex space-x-4"><a href="/pollo" class="font-semibold ">Pollo</a></button>
    </div>
    <div class="absolute -top-6 left-20">
      <button class="bg-[#869F99] px-5 py-1 pb-10 rounded-md flex space-x-4"><a href="/cerdo" class="font-semibold ">cerdo</a></button>
    </div>
   <div class="absolute -top-6 right-0">
      <button class=" bg-[#a9b199] px-5 py-1 pb-10 rounded-md flex space-x-4"><a href="/limpieza" class="font-semibold ">otros</a></button>
    </div>
    <form 
    id="pedidoForm" 
    class="relative bg-[#869F99] p-8 rounded-2xl shadow-lg w-full max-w-md space-y-4"
    >
    <div id="error-container"></div>
    
    <h2 class="text-2xl font-bold text-center text-gray-700">Formulario de Pedido</h2>
    
    <div class="grid grid-cols-2 gap-3">
      <div class="">
        <label class="block text-gray-700 font-semibold mb-1" for="opciones" >Local</label>
        <select id="opciones" name="opciones" class="p-2 font-semibold bg-white focus:ring-blue-500 focus:border-blue-500 border border-gray-300 rounded-md w-full ">
          <option value="Local Guernica">Local Guernica</option>
          <option value="Central Glew">Central Glew</option>
        </select>
      </div>
      <div>
        <label class="block text-gray-700 font-semibold mb-1" for="estado" >estado</label>
        <select id="estado" name="estado" class="p-2  font-semibold bg-white focus:ring-blue-500 focus:border-blue-500 border border-gray-300 rounded-md w-full ">
          <option value="Inicio">Inicio</option>
          <option value="Produccoin">Produccion</option>
          <option value="Envio">Envio</option>
          <option value="Ingreso">Ingreso</option>
          <option value="Final">Final</option>
        </select>
      </div>
      
      <div>
        <label class="block text-gray-700 font-semibold mb-1">Fecha</label>
        <input type="text" name="fecha" id="fecha" required readonly class="w-full border rounded-lg p-2 bg-white">
      </div>
      
      <div>
        <label class="block text-gray-700 font-semibold mb-1">Cerdo</label>
        <input type="text" name="cerdo" class="w-full border rounded-lg p-2 bg-white ">
      </div>
      <div>
        <label class="block text-gray-700 font-semibold mb-1">Carre</label>
        <input type="text" name="carre" class="w-full border rounded-lg p-2 bg-white">
      </div>
      <div>
        <label class="block text-gray-700 font-semibold mb-1">Pecho</label>
        <input type="text" name="pecho" class="w-full border rounded-lg p-2 bg-white">
      </div>
      <div>
        <label class="block text-gray-700 font-semibold mb-1">Matambre</label>
        <input type="text" name="matambre" class="w-full border rounded-lg p-2 bg-white">
      </div>
      <div>
        <label class="block text-gray-700 font-semibold mb-1">Lomo</label>
        <input type="text" name="lomo" class="w-full border rounded-lg p-2 bg-white">
      </div>
      <div>
        <label class="block text-gray-700 font-semibold mb-1">Bondiola</label>
        <input type="text" name="bondiola" class="w-full border rounded-lg p-2 bg-white">
      </div>
      <div class="">
        <label class="block text-gray-700 font-semibold mb-1">Chorizo</label>
        <input type="text" name="chorizo" class="w-full border rounded-lg p-2 bg-white">
      </div>
    </div>
    
    <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition">
      Enviar Pedido
    </button>
  </form>
</div>

<!-- validaciones -->

<script>
import type Cerdo from "./cerdo.astro";

    // Establecer fecha actual automáticamente
    const fechaInput = document.getElementById('fecha') as HTMLInputElement;
    if (fechaInput) {
        const hoy = new Date();
        const dia = String(hoy.getDate()).padStart(2, '0');
        const mes = String(hoy.getMonth() + 1).padStart(2, '0');
        const año = hoy.getFullYear();
        fechaInput.value = `${dia}/${mes}/${año}`;
    }

    // Manejar envío del formulario
    const form = document.getElementById('pedidoForm');
    if (form) {
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target as HTMLFormElement);
            
            const data = {
                grupo: "Cerdo",
                local: formData.get('opciones'),
                estado: formData.get('estado'),
                fecha: formData.get('fecha'),
                Cerdo: Number(formData.get('Cerdo') || 0),
                carre: Number(formData.get('carre') || 0),
                pecho: Number(formData.get('pecho') || 0),
                matambre: Number(formData.get('matambre') || 0),
                lomo: Number(formData.get('lomo') || 0),
                bondiola: Number(formData.get('bondiola') || 0),
                chorizo: Number(formData.get('chorizo') || 0),
            };

            try {
                const errorContainer = document.getElementById('error-container');
                
                // Mostrar mensaje de carga
                if (errorContainer) {
                    errorContainer.innerHTML = '<div class="text-blue-500">Enviando pedido...</div>';
                }

                const response = await fetch('https://web-66vzoi1semdv.up-de-fra1-k8s-1.apps.run-on-seenode.com/stock', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                if (!response.ok) {
                    throw new Error(`Error: ${response.status} ${response.statusText}`);
                }

                const result = await response.json();
                
                if (errorContainer) {
                    errorContainer.innerHTML = '<div class="text-green-500">Pedido enviado con éxito!</div>';
                }
                
                // Limpiar el formulario
                (form as HTMLFormElement).reset();
                
                // Restablecer la fecha
                if (fechaInput) {
                    const hoy = new Date();
                    const dia = String(hoy.getDate()).padStart(2, '0');
                    const mes = String(hoy.getMonth() + 1).padStart(2, '0');
                    const año = hoy.getFullYear();
                    fechaInput.value = `${dia}/${mes}/${año}`;
                }
            } catch (error: any) {
                console.error('Error:', error);
                const errorContainer = document.getElementById('error-container');
                if (errorContainer) {
                    errorContainer.innerHTML = `<div class="text-red-500">Error al enviar el pedido: ${error.message || 'Error desconocido'}</div>`;
                }
            }
        });
    }

</script>