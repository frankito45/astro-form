---
import Layout from "../layouts/Layout.astro";

const {estados,grupos,dataParse } = Astro.props;

---

<div class="mb-4 flex flex-wrap gap-4">

  <div>
    <label class="font-semibold mr-2">Estado:</label>
    <select id="filtro-estado" class="border px-2 py-1 rounded">
      <option value="">Todos</option>
      {estados.map((e) => (
        <option value={e}>{e}</option>
      ))}
    </select>
  </div>

  <div>
    <label class="font-semibold mr-2">Grupo:</label>
    <select id="filtro-grupo" class="border px-2 py-1 rounded">
      <option value="">Todos</option>
      {grupos.map((g) => (
        <option value={g}>{g}</option>
      ))}
    </select>
  </div>

  <div>
    <label class="font-semibold mr-2">Fecha:</label>
    <input type="date" id="filtro-fecha" class="border px-2 py-1 rounded" />
  </div>

</div>


<!-- ================= CARDS =================== -->
<div id="card" class=" grid-cols-1 gap-4 p-2 ">
  {dataParse.map((data) => (
    <div class="w-auto bg-white border border-gray-200 shadow rounded-xl p-4 flex items-center justify-around" data-grupo={data.grupo} data-estado={data.estado} data-fecha={data.fecha}>
      <header class="mb-3">
        <h2 class="text-xl font-bold text-gray-800">{data.grupo}</h2>
        <p class="text-sm text-gray-600"><strong>Local:</strong> {data.local}</p>
        <p class="text-sm text-gray-600"><strong>Estado:</strong> {data.estado}</p>
        <p class="text-sm text-gray-600"><strong>Fecha:</strong> {data.fecha}</p>
      </header>

      <ul class="space-y-1  ">
        {Object.entries(data)
          .filter(([key]) => !["id", "local", "estado", "fecha", "grupo"].includes(key))
          .map(([key, value]) => (
            <li class="text-sm text-gray-700">
              <span class="font-semibold">{key}:</span> {value}
            </li>
          ))}
      </ul>
    </div>
  ))}
</div>

<script>
  const tablaContainer = document.getElementById("tabla-container");
  const cardContainer = document.getElementById("card");

  const fEstado = document.getElementById("filtro-estado");
  const fGrupo = document.getElementById("filtro-grupo");
  const fFecha = document.getElementById("filtro-fecha");

  // Convertir fecha input yyyy-mm-dd â†’ dd/mm/yyyy
  function convertirFecha(iso) {
    if (!iso) return "";
    const [y, m, d] = iso.split("-");
    return `${d}/${m}/${y}`;
  }

  function ajustarVista() {
    if (window.innerWidth < 769) {
      tablaContainer.style.display = "none";
      cardContainer.style.display = "grid";
    } else {
      tablaContainer.style.display = "block";
      cardContainer.style.display = "none";
    }
  }

  window.addEventListener("load", ajustarVista);
  window.addEventListener("resize", ajustarVista);

  function aplicarFiltros() {
    const estado = fEstado.value;
    const grupo = fGrupo.value;
    const fecha = convertirFecha(fFecha.value);


    // CARDS
    document.querySelectorAll("#card > div").forEach((card) => {
      const okEstado = !estado || card.dataset.estado === estado;
      const okGrupo = !grupo || card.dataset.grupo === grupo;
      const okFecha = !fecha || card.dataset.fecha === fecha;

      card.style.display = okEstado && okGrupo && okFecha ? "" : "none";
    });
  }

  fEstado.addEventListener("change", aplicarFiltros);
  fGrupo.addEventListener("change", aplicarFiltros);
  fFecha.addEventListener("change", aplicarFiltros);
</script>
